.SUFFICES: .out .log

RDEV=R
RLIBS=/home/ripley/R/Lib32
BACKUP=../tests32-keep

R2OpenBUGS-OPTS = --no-tests 
## hit CPU limit
AGSDest-OPTS = --no-vignettes
ARAMIS-OPTS = --no-vignettes
BASS-OPTS = --no-vignettes
BB-OPTS = --no-tests --no-vignettes
BMS-OPTS = --no-vignettes
Bclim-OPTS = --no-vignettes
BuyseTest-OPTS = --no-tests
CALIBERrfimpute-OPTS = --no-build-vignettes
CONOR-OPTS = --no-examples
CDVine-OPTS = --no-build-vignettes
CORE-OPTS = --no-build-vignettes
ChemoSpec-OPTS = --no-build-vignettes
Cubist-OPTS = --no-build-vignettes
D2C-OPTS = --no-build-vignettes
DAKS-OPTS = --no-vignettes
DDD-OPTS = --no-examples
DLMtool-OPTS = --no-vignettes
DOBAD-OPTS = --no-vignettes
EpiModel-OPTS = --no-vignettes
GOGANPA-OPTS = --no-examples
GSM-OPTS = --no-examples
GenABEL-OPTS = --no-examples
GiANT-OPTS = --no-vignettes
Gmisc-OPTS = --no-tests
HiveR-OPTS = --no-vignettes
IDPSurvival-OPTS = --no-build-vignettes
Kmisc-OPTS = --no-vignettes
LaplacesDemon-OPTS = --no-vignettes
LogConcDEAD-OPTS = --no-vignettes
MetabolAnalyze-OPTS = --no-examples
ModelMap-OPTS = --no-vignettes
NMF-OPTS = --no-tests --no-vignettes
## runs of of memory
OmicKriging-OPTS = --no-vignettes
PAGI-OPTS = --no-vignettes
PSCBS-OPTS = --no-build-vignettes
PerformanceAnalytics-OPTS = --no-vignettes
PopGenReport-OPTS = --no-vignettes
PortfolioAnalytics-OPTS = --no-vignettes
Rchoice-OPTS = --no-vignettes
#RFinanceYJ-OPTS = --no-examples
SCGLR-OPTS = --no-vignettes
SNPRelate-OPTS = --no-examples --no-tests --no-vignettes
SensMixed-OPTS = --no-tests
SpaDES-OPTS = --no-tests --no-vignettes
STAR-OPTS = --no-vignettes
SamplingStrata-OPTS = --no-vignettes
Sim.DiffProc-OPTS = --no-examples --no-tests
SpatialVX-OPTS = --no-examples
StatMatch-OPTS = --no-vignettes
TriMatch-OPTS = --no-vignettes
TSjson-OPTS = --no-examples --no-tests
VGAM-OPTS = --no-vignettes
ZeligGAM-OPTS = --no-vignettes
abc-OPTS = --no-vignettes
adehabitatLT-OPTS = --no-examples --no-vignettes
amei-OPTS = --no-vignettes
amen-OPTS = --no-build-vignettes
amer-OPTS = --no-tests --no-vignettes
apcluster-OPTS = --no-vignettes
argparse-OPTS = --no-build-vignettes
aspect-OPTS = --no-vignettes
babel-OPTS = --no-vignettes
bayesPop-OPTS = --no-tests
bcool-OPTS= --no-vignettes
bfp-OPTS = --no-tests
caret-OPTS = --no-vignettes
choroplethr-OPTS = --no-vignettes
copula-OPTS = --no-vignettes
coxphf-OPTS = --no-examples
## used 137m CPU
crawl-OPTS = --no-vignettes
crimCV-OPTS = --no-examples
crmPack-OPTS = --no-vignettes
crs-OPTS = --no-vignettes
## times out at 90m
ctmm-OPTS = --no-build-vignettes
#dbmss-OPTS = --no-vignettes
dismo-OPTS = --no-vignettes
dlmodeler-OPTS = --no-tests
dse-OPTS = --no-tests
easyPubMed-OPTS = --no-examples
enaR-OPTS = --no-vignettes
eqtl-OPTS = --no-examples
expands-OPTS = --no-vignettes
expectreg-OPTS = --no-examples --no-vignettes --no-tests
fanplot-OPTS = --no-vignettes
fbRanks-OPTS = --no-vignettes
fda-OPTS = --no-examples
flexclust-OPTS = --no-tests
flexmix-OPTS = --no-build-vignettes
## needs R2BayesX
gamboostLSS-OPTS = --no-vignettes
geiger-OPTS = --no-vignettes
geozoo-OPTS = --no-examples
glmmTMBo-OPTS = --no-tests --no-vignettes
iSubpathwayMiner-OPTS = --no-vignettes
icd9-OPTS = --no-build-vignettes
itsdaug-OPTS = --no-vignettes
##Â microbenchmark
lazyeval-OPTS = --no-vignettes
lifecontingencies-OPTS = --no-build-vignettes
lfe-OPTS = --no-vignettes
laGP-OPTS = --no-vignettes
lokern-OPTS = --no-examples --no-tests
lossDev-OPTS = --no-vignettes
marked-OPTS = --no-examples
mcemGLM-OPTS = --no-vignettes
mcmc-OPTS = --no-build-vignettes
mediation-OPTS = --no-vignettes
metaMA-OPTS = --no-vignettes
micEconCES-OPTS = --no-tests --no-vignettes
mixtools-OPTS = --no-build-vignettes
mnlogit-OPTS = --no-vignettes
modTempEff-OPTS = --no-vignettes
monomvn-OPTS = --no-examples
move-OPTS = --no-build-vignettes
mvnfast-OPTS = --no-vignettes
nFactors-OPTS = --no-vignettes
ndtv-OPTS = --no-vignettes
netweavers-OPTS = --no-vignettes
np-OPTS = --no-examples --no-vignettes
nsRFA-OPTS = --no-vignettes
ordinalgmifs-OPTS = --no-vignettes
patchDVI-OPTS = --no-build-vignettes
phangorn-OPTS = --no-vignettes
phylosim-OPTS = --no-vignettes
pomp-OPTS = --no-tests --no-vignettes
poweRlaw-OPTS = --no-build-vignettes
psych-OPTS = --no-vignettes
psychomix-OPTS = --no-vignettes
pvclust-OPTS = --no-examples
qdap-OPTS = --no-build-vignettes
#qtlcharts-OPTS = --no-tests
rWMBAT-OPTS = --no-examples
rattle-OPTS = --no-examples
#rebmix-OPTS = --no-vignettes
remMap-OPTS = --no-examples
rgeolocate-OPTS = --no-tests
#rmarkdown-OPTS = --no-tests
robustlmm-OPTS = --no-tests
rphast-OPTS = --no-examples --no-tests --no-vignettes
rsdmx-OPTS = --no-vignettes
rtfbs-OPTS = --no-examples --no-tests --no-vignettes
secr-OPTS = --no-examples
seriation-OPTS = --no-examples --no-vignettes
simFrame-OPTS = --no-build-vignettes
speedglm-OPTS = --no-examples
speff2trial-OPTS = --no-examples
spikeSlabGAM-OPTS = --no-examples --no-vignettes
surface-OPTS = --no-vignettes
synlik-OPTS = --no-build-vignettes
tergm-OPTS = --no-vignettes
tgp-OPTS = --no-examples --no-vignettes
twang-OPTS = --no-vignettes
unmarked-OPTS = --no-vignettes
vines-OPTS = --no-tests
widals-OPTS = --no-vignettes
## requires spocc
zoon-OPTS = --no-vignettes

## multicore
adegenet-OPTS = --no-vignettes
multicore-OPTS = --no-examples
mboost-OPTS = --no-vignettes
spikeSlabGAM-OPTS = --no-examples --no-vignettes

## OpenMP
sme-OPTS = --no-examples --no-vignettes --no-tests

## slow/broken web access
BACA-OPTS = --no-vignettes
DSPRqtl-OPTS = --no-vignettes
NCBI2R-OPTS = --no-examples
RLastFM-OPTS = --no-examples
TSgetSymbol-OPTS = --no-examples --no-vignettes
atmi-OPTS = --no-examples
celsius-OPTS = --no-examples
speedglm-OPTS = --no-examples
elliptic-OPTS = --no-vignettes
misc3d-OPTS = --no-examples
gstudio-OPTS = --no-vignettes
#XML-OPTS = --no-examples

## tries to use RMySQL
vegdata-OPTS = --no-vignettes
TSdata-OPTS = --no-vignettes

DSL-OPTS = --no-vignettes
vegan-OPTS = --no-build-vignettes

## more BioC packages
opm-OPTS = --no-vignettes

## RWeka
RWeka-OPTS = --no-examples --no-vignettes
FSelector-OPTS = --no-examples
MSIseq-OPTS = --no-examples --no-vignettes
mlr-OPTS = --no-examples --no-tests
partykit-OPTS = --no-tests --no-vignettes

## microbenchmark
dplyr-OPTS = --no-vignettes

## crash etc
FracSim-OPTS=--no-examples

## needs ipython
nbconvertR-OPTS = --no-vignettes

## Fake installs
ROracle-OPTS = --install=fake

## needs exiftool
camtrapR-OPTS = --no-vignettes

## needs API key
fitbitScraper-OPTS = --no-vignettes

domino-OPTS = --no-tests

## needs rst2pdf
argparse-OPTS = --no-vignettes
optparse-OPTS = --no-vignettes


%.out: %.log
	@echo $* ...
	-+@R_LIBS=$(RLIBS) MAKE=make MAKEFLAGS= time $(RDEV) CMD check $(R_OPTS) -l $(RLIBS) --install=check:$*.log $($*-OPTS) $* > $@ 2>&1
	@echo ... $* done

all:
	@$(MAKE) -k install
	@DISPLAY=:5 gmake -k check

install:
	@$(RDEV) --slave -f swallow.R

installn:
	@$(RDEV) --slave -f swallow-parallel.R

LOGS=${shell ls *.log}
check: $(LOGS:.log=.out)

backup:
	@mkdir -p $(BACKUP)
	@cp -p Makefile script pkgdiff common.R swallow*.R *.out *.log $(BACKUP)

package: summary timing
	@chmod 644 */DESCRIPTION
	@for f in *.out; do \
	  cp `basename $$f .out`/DESCRIPTION `basename $$f .out`.Rcheck/00package.dcf; \
	done
	@gtar jcf Sparc.tar.bz2 *.Rcheck/00check.log *.Rcheck/00install.out *.Rcheck/00package.dcf
	@scp -q Sparc.tar.bz2 gannet:/data/gannet/Rlogs

summary:
	@Rscript ../summary.R
	@scp -pq check.csv gannet:/data/gannet/Rlogs/Sparc-check.csv

timing:
	@Rscript ../check_times.R
	@scp -pq timings.tab gannet:/data/gannet/Rlogs/Sparc-times.tab

clean:
	find * -type d -exec rm -rf {} \;
	rm -f *.log

veryclean: clean
	rm -f *.out

rm-recommended:
	rm -rf KernSmooth.* MASS.* Matrix.log Matrix.out boot.* \
	  class.* cluster.log cluster.out \
	  codetools.* foreign.* lattice.* mgcv.* nlme.* nnet.* \
	  rpart.log rpart.out spatial.log spatial.out survival.*

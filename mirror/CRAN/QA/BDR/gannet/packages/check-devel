#! /bin/csh
~/R/packages/InUse.R ~/R/test-dev || exit 1
~/R/packages/InUse.R ~/R/packages/tests-devel || exit 1

limit stacksize 20M

set path=(~/bin /usr/local/bin /usr/local/texbin /usr/sbin $path /usr/lib64/openmpi/bin)
setenv PKG_CONFIG_PATH /usr/local/lib64/pkgconfig:/usr/lib64/pkgconfig

cd ~/R/svn/R-devel
svn up
env CRAN_RSYNC=/data/gannet/ripley/R/packages tools/rsync-recommended
make -j20 -C ~/R/R-devel
~/R/R-devel//bin/Rscript -e 'update.packages(.Library, ask = F)'
make -j20 -C ~/R/R-devel32
~/R/R-devel32//bin/Rscript -e 'update.packages(.Library, ask = F)'
cd R/packages
~/R/packages/revdeps1 ~/R/test-dev ~/R/packages/tests-devel/revdeps.rds
/data/gannet/ripley/R/R-devel/bin/Rscript unavailable.R
env DISPLAY=:5 /data/gannet/ripley/R/R-devel/bin/Rscript updates.R
~/R/packages/revdeps2 ~/R/test-dev ~/R/packages/tests-devel/revdeps.rds
rm -f ~/R/packages/tests-devel/revdeps.rds
cd tests-devel
make unpack
./script
cat check_log
echo 'packaging'
make package
echo 'done'
